<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spondle (canary A1)</title>

  <!-- Base CSS -->
  <link rel="stylesheet" href="app.v15.css" />
  <!-- Fixed-header override -->
  <link rel="stylesheet" href="app.v17.css" />

  <style>
    /* lightweight grid */
    .grid { display: grid; gap: 14px; }
    @media (min-width: 680px){ .grid { grid-template-columns: 1fr 1fr; } }
    @media (min-width: 980px){ .grid { grid-template-columns: 1fr 1fr 1fr; } }

    /* load more button */
    .loadmore-wrap { display:flex; justify-content:center; margin: 18px 0 8px; }
    .btn-ghost {
      background: transparent; border: 1px solid var(--card-border,#2a2f3a);
      color: var(--text,#dfe7ff); padding: 10px 16px; border-radius: 10px;
    }
  </style>
</head>
<body>
  <!-- ===== Fixed Header ===== -->
  <header class="site-header" id="siteHeader">
    <div class="nav-wrap">
      <a class="brand" href="index.html">
        <span class="brand-dot" aria-hidden="true"></span>
        <span class="brand-name">Spondle</span>
        <span class="beta-pill">Beta</span>
      </a>
      <nav class="main-nav" aria-label="Primary">
        <a class="nav-tab is-active" href="index.html">Explore<br/>Events</a>
        <a class="nav-tab" href="favourites.html">Favourites <span id="favBadge" class="badge" hidden>0</span></a>
        <a class="nav-tab" href="organisers.html">For<br/>Organisers</a>
      </nav>
    </div>
  </header>

  <!-- Spacer for fixed header -->
  <div class="header-spacer" id="headerSpacer"></div>

  <!-- ===== Page Content ===== -->
  <main class="page">
    <section class="hero">
      <h1>Spondle (canary A1)</h1>
      <p>Discover gigs, comedy, food markets, film nights, community events and more — across the UK.</p>
      <div class="hero-actions">
        <a class="btn primary" href="events.html">Search events</a>
        <a class="btn" href="organisers.html">List your event</a>
      </div>
    </section>

    <!-- Featured card (kept) -->
    <section class="section">
      <h2 class="section-title">Popular right now</h2>
      <a class="card featured" href="event.html?id=harbourside-sessions">
        <div class="card-top">
          <span class="chip">Bristol • 12 Sep</span>
          <button class="heart" aria-label="Save this event" type="button">♡</button>
        </div>
        <h3 class="card-title">The Harbourside Sessions</h3>
        <p class="meta">The Louisiana • 19:30–22:30</p>
        <span class="price-chip">Free Entry</span>
      </a>
    </section>

    <!-- Latest events grid with Load More -->
    <section class="section" id="latestSection">
      <h2 class="section-title">Latest events</h2>
      <div id="homeGrid" class="grid" aria-live="polite"></div>
      <div class="loadmore-wrap" id="lmWrap">
        <button id="loadMoreBtn" class="btn-ghost" type="button">Load more</button>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <small>© 2025 Spondle • build v31j</small>
  </footer>

  <!-- site scripts (if present) -->
  <script src="script.js" defer></script>

  <script>
    // Badge
    (function(){
      try {
        const raw = localStorage.getItem('spondle:favs') || '[]';
        const n = JSON.parse(raw).length;
        if (n > 0) { const b = document.getElementById('favBadge'); b.textContent = n; b.hidden = false; }
      } catch {}
    })();

    // Fixed-header spacer
    function setHeaderSpacer() {
      const header = document.getElementById('siteHeader');
      const spacer = document.getElementById('headerSpacer');
      if (!header || !spacer) return;
      spacer.style.height = header.offsetHeight + 'px';
    }
    window.addEventListener('load', setHeaderSpacer, { once:true });
    window.addEventListener('resize', setHeaderSpacer);

    // ----- Data helpers -----
    function getEventsSample(){
      if (window.SAMPLE_EVENTS && Array.isArray(window.SAMPLE_EVENTS)) return window.SAMPLE_EVENTS;
      const cities = ["Bristol","Manchester","Edinburgh","Cardiff","Leeds","London","Bath","Oxford"];
      const cats = ["Live Music","Comedy","Food & Drink","Theatre","Community","Film","Talks","Family"];
      const venues = ["The Fleece","The Louisiana","The Stand","The Apple","Academy","Arts Centre","Playhouse","Union"];
      const out = [];
      for (let i=0;i<60;i++){
        out.push({
          id: "e"+(1000+i),
          city: cities[i%cities.length],
          date: `${10+(i%20)} Oct`,
          category: cats[i%cats.length],
          title: `${cats[i%cats.length]} Night #${i+1}`,
          venue: venues[i%venues.length],
          time: "19:30–22:30",
          priceLabel: (i%5===0) ? "Free Entry" : "£" + (6 + (i%12))
        });
      }
      return out;
    }
    function cardHTML(ev){
      return `
      <a class="card" href="event.html?id=${encodeURIComponent(ev.id)}">
        <div class="card-top">
          <span class="chip">${ev.city} • ${ev.date}</span>
          <button class="heart" aria-label="Save this event" type="button">♡</button>
        </div>
        <h3 class="card-title">${ev.title}</h3>
        <p class="meta">${ev.venue} • ${ev.time}</p>
        <span class="price-chip">${ev.priceLabel}</span>
      </a>`;
    }

    // ----- Load more logic (12 per batch) -----
    const ALL = getEventsSample();
    const BATCH = 12;
    let shown = 0;

    function renderNextBatch(scrollToFirstNew=true){
      const grid = document.getElementById('homeGrid');
      const start = shown;
      const next = ALL.slice(shown, shown + BATCH);
      if (next.length === 0) return;

      // Append
      const html = next.map(cardHTML).join('');
      const marker = document.createElement('div');
      marker.innerHTML = html;
      const firstNew = marker.firstElementChild; // for scroll alignment
      while (marker.firstChild) grid.appendChild(marker.firstChild);

      // Update counters / button visibility
      shown += next.length;
      if (shown >= ALL.length) document.getElementById('lmWrap').style.display = 'none';

      // Smooth scroll so the first of the new items is at top of viewport
      if (scrollToFirstNew && firstNew) {
        firstNew.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }

    // Init
    window.addEventListener('DOMContentLoaded', function(){
      renderNextBatch(false); // first 12 without jumping
      const btn = document.getElementById('loadMoreBtn');
      btn.addEventListener('click', () => renderNextBatch(true));
    });
  </script>
</body>
</html>
