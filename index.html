<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spondle — Discover what’s on near you</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

  <style>
    :root{
      --bg:#0c0f13; --card:#12171d; --muted:#9fb3c8; --text:#e7edf4;
      --accent1:#6ee7f2; --accent2:#7aa2ff; --ring:rgba(255,255,255,.08);
      --brand-dot:#23e381;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    a{color:inherit;text-decoration:none}
    .container{max-width:980px;margin:0 auto;padding:16px}

    /* Header */
    .header{position:sticky;top:0;z-index:50;background:linear-gradient(180deg, rgba(12,15,19,.9), rgba(12,15,19,.75) 60%, rgba(12,15,19,0));backdrop-filter:saturate(140%) blur(6px);border-bottom:1px solid var(--ring)}
    .header-inner{display:flex;align-items:center;justify-content:space-between;padding:14px 16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .brand-dot{width:10px;height:10px;border-radius:50%;background:var(--brand-dot);box-shadow:0 0 0 6px rgba(35,227,129,.12)}
    .burger{width:42px;height:42px;border-radius:12px;display:grid;place-items:center;border:1px solid var(--ring);background:rgba(255,255,255,.03);cursor:pointer}
    .burger span{display:block;width:20px;height:2px;background:var(--text);border-radius:2px;position:relative}
    .burger span::before,.burger span::after{content:"";position:absolute;left:0;width:20px;height:2px;background:var(--text);border-radius:2px}
    .burger span::before{top:-6px}.burger span::after{top:6px}

    /* Side drawer */
    .drawer-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.3);opacity:0;pointer-events:none;transition:opacity .25s ease;z-index:60}
    .drawer{position:fixed;inset:0 25% 0 auto;max-width:min(420px,92vw);transform:translateX(-100%);transition:transform .28s cubic-bezier(.2,.7,.2,1);background:linear-gradient(180deg,#0e1318,#0b0f13);border-right:1px solid var(--ring);z-index:61;display:flex;flex-direction:column}
    .drawer.open{transform:translateX(0)}
    .drawer-backdrop.show{opacity:1;pointer-events:auto}
    .drawer-head{display:flex;align-items:center;justify-content:space-between;padding:16px;border-bottom:1px solid var(--ring)}
    .close{width:40px;height:40px;border-radius:10px;border:1px solid var(--ring);display:grid;place-items:center;background:rgba(255,255,255,.04);cursor:pointer}
    .close i{width:18px;height:2px;background:var(--text);transform:rotate(45deg);position:relative}
    .close i::after{content:"";position:absolute;width:18px;height:2px;background:var(--text);transform:rotate(90deg)}
    .drawer-body{padding:8px 16px 18px;overflow:auto}
    .menu-group{margin:14px 0}
    .menu-title{font-size:.86rem;color:var(--muted);margin:12px 0 6px}
    .menu a{display:block;padding:12px 10px;border-radius:10px;border:1px solid transparent}
    .menu a:hover{background:rgba(255,255,255,.04);border-color:var(--ring)}

    /* Hero */
    .hero{margin:16px 0 10px}
    .panel{background:radial-gradient(1200px 400px at -10% -40%, rgba(110,231,242,.12), transparent 40%), radial-gradient(1200px 400px at 110% -40%, rgba(122,162,255,.12), transparent 40%), var(--card);
      border:1px solid var(--ring);border-radius:18px;padding:22px;box-shadow:0 10px 40px rgba(0,0,0,.25)}
    .hero h1{margin:0 0 8px;font-size:1.9rem;line-height:1.2}
    .hero p{margin:0 0 18px;color:var(--muted)}
    .btn{display:inline-block;padding:12px 16px;border-radius:12px;border:1px solid var(--ring);background:rgba(255,255,255,.04);font-weight:600}
    .btn.primary{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#0b1117;border:none}

    /* Events */
    h2.section{font-size:1.8rem;margin:22px 0 10px}
    #events-list{display:grid;gap:14px;grid-template-columns:1fr}
    @media(min-width:560px){#events-list{grid-template-columns:1fr 1fr}}
    @media(min-width:900px){#events-list{grid-template-columns:1fr 1fr 1fr}}
    .card{background:var(--card);border:1px solid var(--ring);border-radius:16px;overflow:hidden;box-shadow:0 8px 30px rgba(0,0,0,.2)}
    .media{aspect-ratio:16/9;background:#0b1115;position:relative;overflow:hidden}
    .media img{width:100%;height:100%;object-fit:cover;display:block}
    .fav{position:absolute;right:10px;top:10px;width:38px;height:38px;border-radius:10px;border:1px solid var(--ring);background:rgba(0,0,0,.35);backdrop-filter:blur(3px);display:grid;place-items:center;cursor:pointer}
    .fav svg{width:18px;height:18px;fill:none;stroke:#fff;stroke-width:2}
    .fav.active svg{fill:#ff6b81;stroke:#ff6b81}
    .body{padding:14px}
    .meta{font-size:.82rem;color:var(--muted);display:flex;gap:10px;flex-wrap:wrap;margin-bottom:6px}
    .title{font-weight:700;margin:0 0 6px}
    .price{display:inline-block;margin-top:6px;font-size:.86rem;border:1px solid var(--ring);padding:6px 10px;border-radius:999px;color:#cfe6ff}
    .loadmore-wrap{display:grid;place-items:center;margin:18px 0 28px}
    #load-more{padding:12px 18px;border-radius:12px;border:1px solid var(--ring);background:rgba(255,255,255,.04);color:var(--text);cursor:pointer}
    #load-more:disabled{opacity:.5;cursor:not-allowed}

    /* Footer */
    .footer{border-top:1px solid var(--ring);padding:18px;margin-top:22px;color:var(--muted);text-align:center}
  </style>
</head>
<body>

  <!-- Header -->
  <header class="header">
    <div class="header-inner container">
      <div class="brand">
        <span class="brand-dot"></span>
        <span>Spondle</span>
      </div>
      <button class="burger" id="open-drawer" aria-label="Open menu"><span></span></button>
    </div>
  </header>

  <!-- Drawer -->
  <div class="drawer-backdrop" id="drawer-backdrop"></div>
  <aside class="drawer" id="drawer">
    <div class="drawer-head">
      <div class="brand" style="gap:8px"><span class="brand-dot"></span><strong>Spondle</strong></div>
      <button class="close" id="close-drawer" aria-label="Close menu"><i></i></button>
    </div>
    <div class="drawer-body">
      <div class="menu-group">
        <div class="menu">
          <a href="events.html">Explore events</a>
          <a href="favourites.html">Favourites</a>
          <a href="organiser_dashboard.html">For organisers</a>
          <a href="login.html" id="account-link">Sign in / Account</a>
        </div>
      </div>
      <div class="menu-group">
        <div class="menu-title">Quick links</div>
        <div class="menu">
          <a href="#popular">Popular right now</a>
          <a href="#latest">Latest events</a>
        </div>
      </div>
      <div class="footer">© 2025 Spondle</div>
    </div>
  </aside>

  <main class="container">
    <!-- Hero -->
    <section class="hero">
      <div class="panel">
        <h1>Discover what’s on near you</h1>
        <p>Gigs, comedy, food markets, film nights, community events and more — across the UK.</p>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <a class="btn primary" href="events.html">Search events</a>
          <a class="btn" href="organiser_dashboard.html">List your event</a>
        </div>
      </div>
    </section>

    <!-- Events -->
    <h2 class="section" id="latest">Latest events</h2>
    <div id="events-list" aria-live="polite"></div>
    <div class="loadmore-wrap">
      <button id="load-more">Load more</button>
    </div>
  </main>

  <footer class="footer">© 2025 Spondle</footer>

  <!-- (Optional) Supabase auth label if auth.js is present -->
  <script>
    // Show "Signed in as ..." if auth.js has set window.currentUserEmail
    (function(){
      const link = document.getElementById('account-link');
      if (!link) return;
      try {
        if (window.currentUserEmail) {
          link.textContent = `Account (${window.currentUserEmail})`;
        }
      } catch(e){}
    })();
  </script>

  <!-- Events loader -->
  <script>
    // ---- Data source ----
    const EVENTS_JSON_URL = 'events.json'; // if present; otherwise we fallback
    // A safe fallback so the page never looks empty in case the JSON isn’t there.
    const FALLBACK_EVENTS = [
      {
        id:'e1', title:'The Harbourside Sessions', city:'Bristol', date:'2025-09-12',
        category:'Live Music', venue:'The Louisiana', price:'Free Entry',
        image:'https://images.unsplash.com/photo-1514525253161-7a46d19cd819?q=80&w=1400&auto=format&fit=crop'
      },
      {
        id:'e2', title:'Acoustic Sessions at The Fleece', city:'Bristol', date:'2025-09-21',
        category:'Live Music', venue:'The Fleece', price:'£8',
        image:'https://images.unsplash.com/photo-1506157786151-b8491531f063?q=80&w=1400&auto=format&fit=crop'
      },
      {
        id:'e3', title:'Family Science Day', city:'Manchester', date:'2025-09-28',
        category:'Community', venue:'Science & Industry Museum', price:'£6',
        image:'https://images.unsplash.com/photo-1551836022-4c4c79ecde51?q=80&w=1400&auto=format&fit=crop'
      }
    ];

    const PAGE_SIZE = 12;
    let allEvents = [];
    let page = 0;

    const listEl = document.getElementById('events-list');
    const loadBtn = document.getElementById('load-more');

    // Favourites (localStorage)
    const FAV_KEY = 'spondle_favourites';
    const getFaves = () => new Set(JSON.parse(localStorage.getItem(FAV_KEY) || '[]'));
    const setFaves = s => localStorage.setItem(FAV_KEY, JSON.stringify([...s]));

    function favButton(id){
      const btn = document.createElement('button');
      btn.className = 'fav';
      btn.innerHTML = `<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 21s-6.7-4.35-9.33-7.6C.46 10.96 2 7.5 5.1 7.5c1.86 0 3.13 1.02 3.9 2.15.77-1.13 2.04-2.15 3.9-2.15 3.1 0 4.64 3.46 2.43 5.9C18.7 16.65 12 21 12 21Z"/></svg>`;
      const faves = getFaves();
      if (faves.has(id)) btn.classList.add('active');
      btn.addEventListener('click', (e)=>{
        e.stopPropagation();
        e.preventDefault();
        const s = getFaves();
        if (s.has(id)) s.delete(id); else s.add(id);
        setFaves(s);
        btn.classList.toggle('active');
      });
      return btn;
    }

    function card(ev){
      const el = document.createElement('article');
      el.className = 'card';
      el.innerHTML = `
        <div class="media">
          <img alt="" loading="lazy" src="${ev.image || 'https://images.unsplash.com/photo-1492684223066-81342ee5ff30?q=80&w=1400&auto=format&fit=crop'}" />
        </div>
        <div class="body">
          <div class="meta"><span>${ev.city}</span>•<span>${ev.category}</span>•<span>${formatDate(ev.date)}</span></div>
          <h3 class="title">${ev.title}</h3>
          <div class="meta">${ev.venue || ''}</div>
          <span class="price">${ev.price || 'Free'}</span>
        </div>
      `;
      el.querySelector('.media').appendChild(favButton(ev.id));
      el.addEventListener('click', ()=> {
        // Navigate to event page if you have one:
        window.location.href = `event.html?id=${encodeURIComponent(ev.id)}`;
      });
      return el;
    }

    function formatDate(iso){
      try{
        const d = new Date(iso);
        return d.toLocaleDateString(undefined,{day:'2-digit',month:'short'});
      }catch{return ''}
    }

    function renderNext(){
      const start = page * PAGE_SIZE;
      const slice = allEvents.slice(start, start + PAGE_SIZE);
      slice.forEach(ev => listEl.appendChild(card(ev)));
      page++;
      if (page * PAGE_SIZE >= allEvents.length){
        loadBtn.disabled = true;
        loadBtn.textContent = 'No more events';
      } else {
        loadBtn.disabled = false;
        loadBtn.textContent = 'Load more';
      }
    }

    async function loadData(){
      try{
        const res = await fetch(EVENTS_JSON_URL, {cache:'no-store'});
        if (!res.ok) throw new Error('no json');
        const data = await res.json();
        // Expect either {events:[...]} or [...]
        const arr = Array.isArray(data) ? data : (data.events || []);
        if (!arr.length) throw new Error('empty');
        allEvents = normalize(arr);
      }catch{
        // Fallback so page isn’t empty
        allEvents = normalize(FALLBACK_EVENTS);
      }
    }

    function normalize(arr){
      // Coerce into the fields we use
      return arr.map((e,i)=>({
        id: e.id || `ev-${i}`,
        title: e.title || e.name || 'Untitled event',
        city: e.city || e.location || e.region || 'UK',
        date: e.date || e.start_date || new Date().toISOString().slice(0,10),
        category: e.category || e.type || 'General',
        venue: e.venue || e.place || '',
        price: e.price || e.cost || 'Free',
        image: e.image || e.img || e.photo
      }));
    }

    loadBtn.addEventListener('click', renderNext);

    (async function init(){
      await loadData();
      renderNext(); // first 12 (or fewer if fallback)
    })();

    // Drawer wiring
    const drawer = document.getElementById('drawer');
    const backdrop = document.getElementById('drawer-backdrop');
    document.getElementById('open-drawer').addEventListener('click', ()=>{
      drawer.classList.add('open'); backdrop.classList.add('show');
    });
    document.getElementById('close-drawer').addEventListener('click', ()=>{
      drawer.classList.remove('open'); backdrop.classList.remove('show');
    });
    backdrop.addEventListener('click', ()=>{
      drawer.classList.remove('open'); backdrop.classList.remove('show');
    });
  </script>
</body>
</html>
