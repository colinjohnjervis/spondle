<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spondle — What’s on near you</title>
  <link rel="stylesheet" href="app.v15.css">
  <style>
    /* layout fixes */
    .page-wrap {max-width:1100px;margin:0 auto;padding:16px;}
    .hero {background:linear-gradient(135deg,#10131a 0%,#0d1117 100%);border-radius:18px;padding:24px;margin-top:12px}
    .grid {display:grid;grid-template-columns:repeat(1,minmax(0,1fr));gap:16px}
    @media (min-width:520px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media (min-width:900px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
    .hidden{display:none}
    .sticky-header{position:sticky;top:0;z-index:40;background:#0b0f14;border-bottom:1px solid rgba(255,255,255,.06)}
    .brand{display:flex;align-items:center;gap:10px;padding:12px 16px}
    .brand-bullet{width:10px;height:10px;border-radius:50%;background:#47e6b1;box-shadow:0 0 8px #47e6b1}
    .brand-name{font-weight:700;color:#e6f0ff}
    /* sidebar */
    .sidebar-toggle{position:absolute;right:14px;top:10px;border-radius:10px;padding:10px;background:rgba(255,255,255,.06)}
    .drawer{position:fixed;inset:0;display:none}
    .drawer.open{display:block}
    .drawer .scrim{position:absolute;inset:0;background:rgba(0,0,0,.55)}
    .drawer .panel{position:absolute;right:0;top:0;height:100%;width:min(88vw,380px);background:#0c1118;border-left:1px solid rgba(255,255,255,.08);padding:18px;overflow:auto}
    .drawer a{display:flex;align-items:center;gap:10px;padding:12px;border-radius:12px;color:#e7edf8;text-decoration:none}
    .drawer a:hover{background:rgba(255,255,255,.06)}
    .pill{display:inline-flex;align-items:center;gap:8px;background:linear-gradient(90deg,#4cd2ff,#63f0c6);color:#0b1020;font-weight:700;border-radius:14px;padding:10px 14px;text-decoration:none}
    .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:10px 14px;color:#e7edf8;text-decoration:none;background:rgba(255,255,255,.04)}
    .loadmore-wrap{display:flex;justify-content:center;margin:24px 0 48px}
  </style>
</head>
<body>
  <!-- Sticky header with logo + sidebar button -->
  <header class="sticky-header">
    <div class="brand page-wrap">
      <span class="brand-bullet" aria-hidden="true"></span>
      <span class="brand-name">Spondle</span>
      <button id="sidebarBtn" class="sidebar-toggle" aria-label="Open menu">
        <!-- hamburger -->
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
          <path d="M4 6h16M4 12h16M4 18h16" stroke="#cfe3ff" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- Sidebar drawer -->
  <aside id="drawer" class="drawer" aria-hidden="true">
    <div class="scrim" id="scrim"></div>
    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong style="color:#e6f0ff">Menu</strong>
        <button id="closeDrawer" class="btn">Close</button>
      </div>
      <nav style="display:grid;gap:6px;margin-top:8px">
        <a href="index.html">Explore events</a>
        <a href="favourites.html">Favourites</a>
        <a href="organiser-dashboard.html">For organisers</a>
        <hr style="border:none;border-top:1px solid rgba(255,255,255,.08);margin:6px 0">
        <a href="login.html" id="authLink">Sign in</a>
      </nav>
    </div>
  </aside>

  <main class="page-wrap">
    <!-- Hero -->
    <section class="hero">
      <h1 style="color:#e9f2ff;font-size:clamp(24px,3.6vw,36px);line-height:1.15;margin:0 0 10px">
        Discover what’s on near you
      </h1>
      <p style="color:#a8b6c9;margin:0 0 18px">
        Gigs, comedy, food markets, film nights, community events and more — across the UK.
      </p>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <a class="pill" href="events.html">Search events</a>
        <a class="btn" href="organiser-dashboard.html">List your event</a>
      </div>
    </section>

    <!-- Events grid (important IDs for JS) -->
    <h2 style="margin:22px 0 10px;color:#e6f0ff">Latest events</h2>
    <div id="eventsGrid" class="grid" aria-live="polite"></div>

    <div class="loadmore-wrap">
      <button id="loadMoreBtn" class="btn">Load more</button>
    </div>
  </main>

  <script>
    /* Sidebar controls */
    const drawer = document.getElementById('drawer');
    document.getElementById('sidebarBtn').addEventListener('click', () => {
      drawer.classList.add('open'); drawer.setAttribute('aria-hidden','false');
    });
    document.getElementById('closeDrawer').addEventListener('click', () => {
      drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true');
    });
    document.getElementById('scrim').addEventListener('click', () => {
      drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true');
    });

    /* Signed-in indicator for menu */
    (async () => {
      try {
        if (window.supabase) {
          const { data: { user } } = await window.supabase.auth.getUser();
          const link = document.getElementById('authLink');
          if (user && link) link.textContent = 'Signed in';
        }
      } catch(_) {}
    })();

    /* Events rendering (defensive: works with SPD_EVENTS or EVENTS) */
    const ALL_EVENTS = (window.SPD_EVENTS || window.EVENTS || []);
    const grid = document.getElementById('eventsGrid');
    const btn  = document.getElementById('loadMoreBtn');

    let batch = 12;
    let shown = 0;

    function cardHTML(e){
      const date  = e.dateText || e.date || '';
      const city  = e.city || e.location || '';
      const price = e.priceText || e.price || '';
      return `
        <article class="event-card">
          <div class="card">
            <div class="card-body">
              <div style="font-size:12px;color:#9fb2c8;margin-bottom:6px">
                ${city ? `<span>${city}</span>` : ''} ${date ? `• <span>${date}</span>` : ''}
              </div>
              <h3 style="color:#eaf2ff;margin:0 0 6px">${e.title || 'Untitled event'}</h3>
              <div style="color:#a9b7c9">${e.venue || ''}${e.time ? ' • '+e.time : ''}</div>
              ${price ? `<div class="price-pill" style="margin-top:8px">${price}</div>` : ''}
            </div>
          </div>
        </article>`;
    }

    function renderMore(){
      const next = ALL_EVENTS.slice(shown, shown + batch);
      if (next.length === 0){ btn.classList.add('hidden'); return; }
      grid.insertAdjacentHTML('beforeend', next.map(cardHTML).join(''));
      shown += next.length;
      if (shown >= ALL_EVENTS.length) btn.classList.add('hidden');
    }

    // If no global data (dev safety), don’t crash—hide controls
    if (!Array.isArray(ALL_EVENTS) || ALL_EVENTS.length === 0){
      grid.innerHTML = '';
      btn.classList.add('hidden');
    } else {
      renderMore();
      btn.addEventListener('click', renderMore);
    }
  </script>

  <!-- Your existing app JS keeps working; leave last so our guards run even if it defines SPD_EVENTS -->
  <script src="auth.js"></script>
  <script src="app.js"></script>
</body>
</html>
