<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spondle — Discover what’s on near you</title>
  <meta name="color-scheme" content="dark">
  <!-- Tailwind (CDN for now) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --bg:#0b0f14;--panel:#111620;--card:#121a24;--ink:#e7edf3;--muted:#a7b2bf;
      --border:rgba(255,255,255,.08);--shine:linear-gradient(135deg,#1a2431,#111620);
      --overlay:rgba(0,0,0,.45);--brand:#39d353;
      --shadow:0 18px 50px rgba(0,0,0,.45);
      --radius:16px;--radius-sm:12px;--speed:.26s;
    }
    html,body{background:#0b0f14;color:var(--ink);}
    .glass {background:linear-gradient(180deg, rgba(10,12,16,.9), rgba(10,12,16,.55) 70%, rgba(10,12,16,0));
            backdrop-filter: blur(6px);}
    /* ===== Locked Sidebar (v1 you liked) ===== */
    .sb-overlay{position:fixed;inset:0;background:var(--overlay);backdrop-filter:saturate(120%) blur(2px);
      opacity:0;pointer-events:none;transition:opacity var(--speed) ease;z-index:60}
    .sb-overlay.active{opacity:1;pointer-events:auto}
    .sb-panel{position:fixed;top:0;left:0;height:100dvh;width:82vw;max-width:420px;background:#151a21;
      color:var(--ink);box-shadow:var(--shadow);transform:translateX(-100%);
      transition:transform var(--speed) ease;z-index:70;display:flex;flex-direction:column}
    .sb-panel.open{transform:translateX(0)}
    .sb-head{display:flex;align-items:center;justify-content:space-between;padding:18px 20px;border-bottom:1px solid var(--border)}
    .sb-title{font-weight:700;letter-spacing:.3px}
    .sb-close{display:grid;place-items:center;width:42px;height:42px;border-radius:12px;background:rgba(255,255,255,.04);
      border:1px solid var(--border);color:var(--ink)}
    .sb-list{padding:10px 10px 6px 10px}
    .sb-item{display:block;padding:14px 12px;margin:4px 0;border-radius:12px;color:var(--ink);text-decoration:none}
    .sb-item:hover{background:rgba(255,255,255,.05)}
    .sb-section{margin:8px 10px 0 10px;padding:10px 12px;font-size:.9rem;color:var(--muted);border-top:1px solid var(--border)}
    .sb-foot{margin-top:auto;padding:16px 20px;color:var(--muted);border-top:1px solid var(--border);font-size:.95rem}
    body.sb-lock{overflow:hidden}

    /* Top bar - minimal */
    .topbar{position:sticky;top:0;z-index:50;display:flex;align-items:center;justify-content:space-between;height:56px;padding:0 14px}
    .brand{display:flex;align-items:center;gap:10px}
    .brand-dot{width:10px;height:10px;border-radius:999px;background:var(--brand)}
    .burger{width:44px;height:44px;border-radius:12px;display:grid;place-items:center;background:rgba(255,255,255,.05);border:1px solid var(--border)}
    .burger-lines,.burger-lines::before,.burger-lines::after{content:"";display:block;width:20px;height:2px;border-radius:2px;background:var(--ink);position:relative}
    .burger-lines::before{position:absolute;transform:translateY(-6px)}
    .burger-lines::after{position:absolute;transform:translateY(6px)}

    /* Cards */
    .event-card{background:var(--card);border:1px solid var(--border);border-radius:18px;overflow:hidden;box-shadow:0 8px 28px rgba(0,0,0,.35)}
    .event-img{aspect-ratio:16/9;object-fit:cover;width:100%}
    .chip{background:rgba(255,255,255,.06);border:1px solid var(--border);color:var(--muted)}
    .fav-btn{position:absolute;right:12px;top:12px;width:44px;height:44px;border-radius:14px;background:rgba(16,20,26,.75);
      display:grid;place-items:center;border:1px solid var(--border);backdrop-filter: blur(4px)}
    .fav-btn svg{opacity:.9}
    .fav-active{color:#ff7ab6}
  </style>
</head>
<body class="min-h-screen">

  <!-- Top bar -->
  <header class="topbar glass">
    <div class="brand">
      <span class="brand-dot"></span>
      <span class="font-semibold tracking-wide">Spondle</span>
    </div>
    <button id="sbOpen" class="burger" aria-label="Open menu" aria-expanded="false" aria-controls="sbPanel">
      <span class="burger-lines" aria-hidden="true"></span>
    </button>
  </header>

  <!-- Sidebar -->
  <div id="sbOverlay" class="sb-overlay" hidden></div>
  <aside id="sbPanel" class="sb-panel" role="dialog" aria-modal="true" aria-label="Menu" hidden>
    <div class="sb-head">
      <div class="sb-title">Menu</div>
      <button id="sbClose" class="sb-close" aria-label="Close menu">✕</button>
    </div>
    <nav class="sb-list">
      <a class="sb-item" href="/events.html">Explore events</a>
      <a class="sb-item" href="/favourites.html">Favourites</a>
      <a class="sb-item" href="/organiser_dashboard.html">For organisers</a>
      <a class="sb-item" href="/login.html">Sign in / Account</a>
      <div class="sb-section">Quick links</div>
      <a class="sb-item" href="#popular">Popular right now</a>
      <a class="sb-item" href="#latest">Latest events</a>
    </nav>
    <div class="sb-foot">© 2025 Spondle</div>
  </aside>

  <!-- Hero -->
  <section class="px-4 sm:px-6 lg:px-8 mt-4">
    <div class="rounded-2xl border border-[color:var(--border)] bg-[color:var(--panel)] p-6 md:p-8 shadow-xl">
      <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">Discover what’s on near you</h1>
      <p class="text-[color:var(--muted)] mt-3 max-w-2xl">
        Gigs, comedy, food markets, film nights, community events and more — across the UK.
      </p>
      <div class="mt-6 flex gap-3">
        <a href="/events.html" class="px-4 py-2 rounded-xl bg-gradient-to-r from-sky-500/30 to-blue-500/30 border border-[color:var(--border)]">
          Search events
        </a>
        <a href="/organiser_dashboard.html" class="px-4 py-2 rounded-xl border border-[color:var(--border)]">
          List your event
        </a>
      </div>
    </div>
  </section>

  <!-- Latest events -->
  <section id="latest" class="px-4 sm:px-6 lg:px-8 pt-8 pb-20">
    <h2 class="text-3xl font-bold mb-4">Latest events</h2>

    <div id="eventsList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5"></div>

    <div class="flex justify-center mt-6">
      <button id="loadMore" class="px-5 py-3 rounded-xl border border-[color:var(--border)] bg-[color:var(--panel)]">
        Load more
      </button>
    </div>
  </section>

  <footer class="px-4 sm:px-6 lg:px-8 pb-10 text-[color:var(--muted)]">© 2025 Spondle</footer>

  <!-- Icons -->
  <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
    <symbol id="heart" viewBox="0 0 24 24">
      <path d="M12 21s-6.716-4.232-9.24-7.2C.91 11.54.75 8.74 2.4 7.08c1.65-1.66 4.33-1.66 5.98 0L12 10.8l3.62-3.72c1.65-1.66 4.33-1.66 5.98 0 1.65 1.66 1.49 4.46-.36 6.72C18.716 16.768 12 21 12 21z" fill="currentColor"/>
    </symbol>
  </svg>

  <script>
    /* ===== Sidebar behaviour (locked v1) ===== */
    (function(){
      const body = document.body;
      const openBtn = document.getElementById('sbOpen');
      const closeBtn = document.getElementById('sbClose');
      const panel = document.getElementById('sbPanel');
      const overlay = document.getElementById('sbOverlay');

      function openMenu(){
        panel.hidden=false; overlay.hidden=false;
        requestAnimationFrame(()=>{
          panel.classList.add('open'); overlay.classList.add('active');
          body.classList.add('sb-lock');
          openBtn.setAttribute('aria-expanded','true');
        });
      }
      function closeMenu(){
        panel.classList.remove('open'); overlay.classList.remove('active');
        body.classList.remove('sb-lock');
        openBtn.setAttribute('aria-expanded','false');
        setTimeout(()=>{ panel.hidden=true; overlay.hidden=true; }, 260);
      }
      openBtn.addEventListener('click', openMenu);
      closeBtn.addEventListener('click', closeMenu);
      overlay.addEventListener('click', closeMenu);
      window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeMenu(); });
    })();

    /* ===== Event rendering with graceful data fallback ===== */

    // 1) Try to use an already-defined dataset (from another file) if present:
    let EVENTS = Array.isArray(window.SPONDLE_EVENTS) ? window.SPONDLE_EVENTS.slice() : [];

    // 2) If empty, try fetching a common location (if your repo has it):
    const tryFetch = async () => {
      if (EVENTS.length) return;
      try {
        const res = await fetch('/data/events.json', { cache: 'no-store' });
        if (res.ok) {
          const json = await res.json();
          if (Array.isArray(json)) EVENTS = json;
        }
      } catch(_) {}
    };

    // 3) If still empty after fetch, use a tiny built-in sample (so the page never looks “empty”)
    const sample = [
      {
        id: "evt-001",
        city: "Bristol", date: "Sep 12", category: "Live Music",
        title: "The Harbourside Sessions",
        venue: "The Louisiana", time: "19:30–22:30", price: "Free Entry",
        image: "https://images.unsplash.com/photo-1517232115160-ff93364542dd?q=80&w=1200&auto=format&fit=crop"
      },
      {
        id: "evt-002",
        city: "Bristol", date: "Sep 21", category: "Live Music",
        title: "Acoustic Sessions at The Fleece",
        venue: "The Fleece", time: "19:00–22:00", price: "£8",
        image: "https://images.unsplash.com/photo-1506157786151-b8491531f063?q=80&w=1200&auto=format&fit=crop"
      },
      {
        id: "evt-003",
        city: "Manchester", date: "Sep 28", category: "Community",
        title: "Family Science Day",
        venue: "Science and Industry Mus.", time: "10:00–16:00", price: "£6",
        image: "https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?q=80&w=1200&auto=format&fit=crop"
      }
    ];

    // Favourites (localStorage)
    const favKey = 'spondle:favs';
    const getFavs = () => {
      try { return JSON.parse(localStorage.getItem(favKey)) || []; } catch { return []; }
    };
    const setFavs = (arr) => localStorage.setItem(favKey, JSON.stringify(arr));
    const toggleFav = (id) => {
      const favs = new Set(getFavs());
      favs.has(id) ? favs.delete(id) : favs.add(id);
      setFavs([...favs]);
    };
    const isFav = (id) => new Set(getFavs()).has(id);

    // Render one card
    const cardHTML = (e) => `
      <article class="event-card relative overflow-hidden">
        <img class="event-img" src="${e.image || 'https://picsum.photos/800/450?blur=2'}" alt="" loading="lazy">
        <button class="fav-btn group" data-fav="${e.id}" aria-label="Add to favourites" title="Favourite">
          <svg width="22" height="22" class="${isFav(e.id)?'fav-active':''}"><use href="#heart"/></svg>
        </button>
        <div class="p-4 sm:p-5">
          <div class="flex flex-wrap gap-2 text-sm mb-2">
            <span class="chip px-2.5 py-1 rounded-full">${e.city} • ${e.date}</span>
            <span class="chip px-2.5 py-1 rounded-full">${e.category}</span>
          </div>
          <h3 class="text-xl font-semibold leading-snug">${e.title}</h3>
          <p class="text-[color:var(--muted)] mt-1">${e.venue} • ${e.time || ''}</p>
          <div class="mt-3">
            <span class="chip inline-block px-3 py-1.5 rounded-full">${e.price || ''}</span>
          </div>
        </div>
      </article>
    `;

    const listEl = document.getElementById('eventsList');
    const btnMore = document.getElementById('loadMore');
    let page = 0, pageSize = 12;

    function renderPage(){
      const start = page * pageSize;
      const slice = EVENTS.slice(start, start + pageSize);
      if (!slice.length) { btnMore.disabled = true; btnMore.classList.add('opacity-50','cursor-not-allowed'); return; }
      const html = slice.map(cardHTML).join('');
      listEl.insertAdjacentHTML('beforeend', html);

      // wire hearts
      slice.forEach(e=>{
        const b = listEl.querySelector(`[data-fav="${e.id}"]`);
        if(!b) return;
        b.addEventListener('click', () => {
          toggleFav(e.id);
          b.querySelector('svg').classList.toggle('fav-active', isFav(e.id));
        });
      });

      page++;
      if (page * pageSize >= EVENTS.length) {
        btnMore.disabled = true; btnMore.classList.add('opacity-50','cursor-not-allowed');
      }
    }

    (async function init(){
      await tryFetch();
      if (!EVENTS.length) EVENTS = sample;

      // Optional: sort newest first by a naive date label if present
      try{
        EVENTS.sort((a,b)=>{
          const toKey = (d)=>Date.parse(d?.fullDate || d?.date || '')||0;
          return toKey(b)-toKey(a);
        });
      }catch(_){}

      renderPage();
      btnMore.addEventListener('click', renderPage);
    })();
  </script>
</body>
</html>
