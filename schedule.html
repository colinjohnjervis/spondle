<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Schedule Setup â€“ Spondle</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabase = createClient(
      "https://jvuunvnbpdfrttusgelz.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp2dXVudm5icGRmcnR0dXNnZWx6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0Nzk0NjksImV4cCI6MjA3MzA1NTQ2OX0.i5-X-GsirwcZl0CdAfGsA6qM4ml5itnekPh0RoDCPVY"
    );

    document.addEventListener("DOMContentLoaded", () => {
      const venueSearch = document.getElementById("venueSearch");
      const venueResults = document.getElementById("venueResults");
      const venueIdField = document.getElementById("venueId");

      // Fetch venues from Supabase
      venueSearch.addEventListener("input", async (e) => {
        const query = e.target.value.trim();
        venueResults.innerHTML = "";
        if (!query) {
          venueResults.classList.add("hidden");
          return;
        }

        const { data, error } = await supabase
          .from("venues")
          .select("id, venue_name, street_name, postcode")
          .ilike("venue_name", `${query}%`)
          .limit(5);

        if (error) {
          console.error("Error fetching venues:", error);
          return;
        }

        if (!data || data.length === 0) {
          venueResults.classList.add("hidden");
          return;
        }

        venueResults.innerHTML = data
          .map(
            (v) => `
          <div class="p-3 rounded-xl bg-slate-800 hover:bg-slate-700 cursor-pointer transition"
               data-id="${v.id}" data-name="${v.venue_name}">
            <p class="font-semibold text-white">${v.venue_name}</p>
            <p class="text-sm text-gray-300">${v.street_name || ""}${
              v.postcode ? ", " + v.postcode : ""
            }</p>
          </div>`
          )
          .join("");

        venueResults.classList.remove("hidden");
      });

      // Handle selection
      venueResults.addEventListener("click", (e) => {
        const card = e.target.closest("[data-id]");
        if (!card) return;
        venueSearch.value = card.dataset.name;
        venueIdField.value = card.dataset.id;
        venueResults.classList.add("hidden");
      });

      // Hide results when clicking elsewhere
      document.addEventListener("click", (e) => {
        if (!venueResults.contains(e.target) && e.target !== venueSearch) {
          venueResults.classList.add("hidden");
        }
      });

      // Date/time pickers
      flatpickr("#fromDate", {
        dateFormat: "d/m/Y",
        defaultDate: "today",
      });
      flatpickr("#toDate", {
        dateFormat: "d/m/Y",
        defaultDate: "today",
      });
      flatpickr("#fromTime", {
        enableTime: true,
        noCalendar: true,
        dateFormat: "H:i",
        time_24hr: true,
        defaultDate: "10:00",
      });
      flatpickr("#toTime", {
        enableTime: true,
        noCalendar: true,
        dateFormat: "H:i",
        time_24hr: true,
        defaultDate: "11:00",
      });
    });
  </script>
</head>

<body class="bg-black text-white min-h-screen flex justify-center p-4">
  <div class="w-full max-w-md bg-slate-900 rounded-2xl p-6">
    <h1 class="text-3xl font-bold mb-4">Schedule Setup</h1>

    <!-- Venue -->
    <div class="mb-6 relative">
      <label for="venueSearch" class="block mb-2">Venue</label>
      <input
        id="venueSearch"
        type="text"
        placeholder="Search by venue name..."
        class="w-full p-3 rounded-xl bg-slate-800 border border-slate-700 focus:border-green-500 focus:ring-0"
        autocomplete="off"
      />
      <input id="venueId" type="text" class="w-full p-3 rounded-xl bg-slate-800 mt-2 text-gray-400" readonly value="Venue ID will appear here" />

      <!-- Results Dropdown -->
      <div
        id="venueResults"
        class="absolute w-full bg-[#0f172a] rounded-xl mt-2 z-50 hidden"
      ></div>
    </div>

    <!-- Dates -->
    <div class="grid grid-cols-2 gap-3 mb-4">
      <div>
        <label for="fromDate" class="block mb-1">From</label>
        <input
          id="fromDate"
          type="text"
          class="w-full p-3 rounded-xl bg-slate-800 border border-slate-700 focus:border-green-500 focus:ring-0"
        />
      </div>
      <div>
        <label for="fromTime" class="block mb-1">Time</label>
        <input
          id="fromTime"
          type="text"
          class="w-full p-3 rounded-xl bg-slate-800 border border-slate-700 focus:border-green-500 focus:ring-0"
        />
      </div>
    </div>

    <div class="grid grid-cols-2 gap-3 mb-4">
      <div>
        <label for="toDate" class="block mb-1">To</label>
        <input
          id="toDate"
          type="text"
          class="w-full p-3 rounded-xl bg-slate-800 border border-slate-700 focus:border-green-500 focus:ring-0"
        />
      </div>
      <div>
        <label for="toTime" class="block mb-1">Time</label>
        <input
          id="toTime"
          type="text"
          class="w-full p-3 rounded-xl bg-slate-800 border border-slate-700 focus:border-green-500 focus:ring-0"
        />
      </div>
    </div>

    <!-- Repeat -->
    <div>
      <label for="repeat" class="block mb-1">Repeat</label>
      <select
        id="repeat"
        class="w-full p-3 rounded-xl bg-slate-800 border border-slate-700 focus:border-green-500 focus:ring-0"
      >
        <option>Does not repeat</option>
        <option>Daily</option>
        <option>Weekly</option>
        <option>Monthly</option>
      </select>
    </div>
  </div>
</body>
</html>
