<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Create Event â€“ Spondle</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="./spondle-layout.css?v=global-9">
  <link rel="stylesheet" href="./styles.css?v=global-9">
  <link rel="stylesheet" href="./hearts.css?v=global-9">
  <style>
    body{background:#000;color:#fff;}
    .carousel-container{position:relative;overflow:hidden;border-radius:12px;margin-top:10px;}
    .carousel-image{width:100%;height:220px;object-fit:cover;border-radius:12px;transition:transform 0.3s ease;}
    .carousel-nav{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,0.6);color:#fff;border:none;border-radius:9999px;width:40px;height:40px;display:flex;align-items:center;justify-content:center;font-size:20px;cursor:pointer;}
    .carousel-nav:hover{background:rgba(255,255,255,0.3);}
    .carousel-prev{left:10px;}
    .carousel-next{right:10px;}
    .carousel-image.selected{outline:3px solid #22c55e;}
    .thumbs{display:flex;gap:6px;margin-top:6px;justify-content:center;}
    .thumbs img{width:60px;height:45px;object-fit:cover;border-radius:6px;cursor:pointer;opacity:.7;transition:opacity .3s ease;}
    .thumbs img:hover{opacity:1;}
  </style>
</head>
<body class="bg-black text-white">
  <div class="max-w-3xl mx-auto p-4">
    <h1 class="text-2xl font-bold mb-4">Create Event</h1>
    <form id="createEventForm" class="space-y-4">

      <!-- Event Title -->
      <div>
        <label for="eventName" class="block mb-1">Title</label>
        <input id="eventName" name="event_name" type="text" placeholder="Event title" class="w-full p-2 rounded bg-gray-900 border border-gray-700">
      </div>

      <!-- Description -->
      <div>
        <label for="description" class="block mb-1">Description</label>
        <textarea id="description" name="description" placeholder="Tell people about your event" class="w-full p-2 rounded bg-gray-900 border border-gray-700"></textarea>
      </div>

      <!-- Category -->
      <div>
        <label for="category" class="block mb-1">Category</label>
        <select id="category" name="category" class="w-full p-2 rounded bg-gray-900 border border-gray-700">
          <option value="">Select category</option>
          <option>Comedy</option>
          <option>Theatre</option>
          <option>Music</option>
          <option>Sports</option>
          <option>Beer Festivals</option>
          <option>Archery</option>
          <option>Frisbee Golf</option>
          <option>Crazy Golf</option>
          <option>Murder Mystery</option>
        </select>
      </div>

      <!-- Stock Image Carousel (dynamic by category) -->
      <div>
        <h3 class="font-semibold mb-1">Or choose a stock image</h3>
        <p class="text-sm text-gray-400 mb-2">Tap to select. Use arrows to browse.</p>
        <div class="carousel-container" id="carouselContainer">
          <img id="carouselImage" class="carousel-image" src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?w=800" alt="stock image">
          <button type="button" class="carousel-nav carousel-prev" id="prevArrow">&#8249;</button>
          <button type="button" class="carousel-nav carousel-next" id="nextArrow">&#8250;</button>
        </div>
        <div class="thumbs" id="carouselThumbs"></div>
      </div>

      <!-- Image URL -->
      <div>
        <label for="imageUrl" class="block mb-1">Image URL</label>
        <input id="imageUrl" name="image_url" type="url" placeholder="https://..." class="w-full p-2 rounded bg-gray-900 border border-gray-700">
        <p class="text-sm text-gray-400 mt-1">Selecting a stock image fills this automatically. You can paste your own URL too.</p>
      </div>

      <!-- Publish Status -->
      <div>
        <label for="publishStatus" class="block mb-1">Publish Status</label>
        <select id="publishStatus" name="publish_status" class="w-full p-2 rounded bg-gray-900 border border-gray-700">
          <option>Draft</option>
          <option>Published</option>
        </select>
      </div>

      <!-- Schedule Buttons -->
      <div>
        <label class="block mb-1">Schedule</label>
        <div class="flex gap-2">
          <button type="button" id="singleTab" class="flex-1 bg-blue-600 text-white rounded p-2">Single</button>
          <button type="button" id="recurringTab" class="flex-1 bg-gray-800 text-white rounded p-2">Recurring</button>
          <button type="button" id="tourTab" class="flex-1 bg-gray-800 text-white rounded p-2">Tour</button>
        </div>
      </div>

      <!-- Single Schedule (default visible) -->
      <div id="singleSection" class="space-y-2">
        <label class="block">Starts</label>
        <input type="date" id="singleDate" name="event_date" class="w-full p-2 rounded bg-gray-900 border border-gray-700">
        <input type="time" id="singleTime" name="event_time" class="w-full p-2 rounded bg-gray-900 border border-gray-700">
      </div>

      <!-- Recurring -->
      <div id="recurringSection" class="hidden space-y-2">
        <label class="block">Starts</label>
        <input type="date" id="recurringStart" class="w-full p-2 rounded bg-gray-900 border border-gray-700">
        <label class="block">Ends</label>
        <input type="date" id="recurringEnd" class="w-full p-2 rounded bg-gray-900 border border-gray-700">
        <label class="block">Frequency</label>
        <select id="recurringFrequency" class="w-full p-2 rounded bg-gray-900 border border-gray-700">
          <option>Daily</option>
          <option>Weekly</option>
          <option>Monthly</option>
        </select>
      </div>

      <!-- Tour -->
      <div id="tourSection" class="hidden space-y-2">
        <p class="text-gray-400 text-sm">Add multiple venues and dates for your tour.</p>
        <div id="tourVenuesContainer"></div>
        <button type="button" id="addVenueBtn" class="bg-gray-700 text-white rounded p-2 w-full">+ Add Venue</button>
      </div>

      <!-- Venue (for Single/Recurring) -->
      <div>
        <label for="venueName" class="block mb-1">Venue</label>
        <input id="venueName" name="venue_name" type="text" placeholder="Venue name" class="w-full p-2 rounded bg-gray-900 border border-gray-700">
        <input id="cityTown" name="city_town" type="text" placeholder="City / Town" class="w-full p-2 mt-2 rounded bg-gray-900 border border-gray-700">
        <input id="postcode" name="postcode" type="text" placeholder="Postcode" class="w-full p-2 mt-2 rounded bg-gray-900 border border-gray-700">
      </div>

      <!-- Form buttons -->
      <div class="flex justify-end gap-3 pt-2">
        <button type="reset" class="px-4 py-2 bg-gray-700 rounded">Reset</button>
        <button type="submit" class="px-4 py-2 bg-blue-600 rounded text-white">Save Event</button>
      </div>
    </form>
  </div>

  <script>
    /* -----------------------------
   SUPABASE INITIALIZATION
------------------------------ */
const supabase = window.supabase.createClient(
  'https://jvuunvnbpdfrttusgelz.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp2dXVudm5icGRmcnR0dXNnZWx6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0Nzk0NjksImV4cCI6MjA3MzA1NTQ2OX0.i5-X-GsirwcZl0CdAfGsA6qM4ml5itnekPh0RoDCPVY'
);

/* -----------------------------
   STOCK IMAGES BY CATEGORY
------------------------------ */
const stockImages = {
  Comedy: [
    "https://images.unsplash.com/photo-1525182008055-f88b95ff7980?auto=format&fit=crop&w=1200&q=80",
    "https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?auto=format&fit=crop&w=1200&q=80",
    "https://images.unsplash.com/photo-1520854221256-17451cc331bf?auto=format&fit=crop&w=1200&q=80"
  ],
  Theatre: [
    "https://images.unsplash.com/photo-1507925921958-8a62f3d1a50d?auto=format&fit=crop&w=1200&q=80",
    "https://images.unsplash.com/photo-1492684223066-81342ee5ff30?auto=format&fit=crop&w=1200&q=80",
    "https://images.unsplash.com/photo-1470225620780-dba8ba36b745?auto=format&fit=crop&w=1200&q=80"
  ],
  Music: [
    "https://images.unsplash.com/photo-1511379938547-c1f69419868d?auto=format&fit=crop&w=1200&q=80",
    "https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?auto=format&fit=crop&w=1200&q=80",
    "https://images.unsplash.com/photo-1470225620780-dba8ba36b745?auto=format&fit=crop&w=1200&q=80"
  ],
  Sports: [
    "https://images.unsplash.com/photo-1505842465776-3acb9e92c0f0?auto=format&fit=crop&w=1200&q=80",
    "https://images.unsplash.com/photo-1546519638-68e109498ffc?auto=format&fit=crop&w=1200&q=80",
    "https://images.unsplash.com/photo-1517649763962-0c623066013b?auto=format&fit=crop&w=1200&q=80"
  ],
  "Beer Festivals": [
    "https://images.unsplash.com/photo-1507874457470-272b3c8d8ee2?auto=format&fit=crop&w=1200&q=80",
    "https://images.unsplash.com/photo-1470337458703-46ad1756a187?auto=format&fit=crop&w=1200&q=80",
    "https://images.unsplash.com/photo-1501594907352-04cda38ebc29?auto=format&fit=crop&w=1200&q=80"
  ],
  Archery: [
    "https://images.unsplash.com/photo-1600794003191-25e65b7282b6?auto=format&fit=crop&w=1200&q=80",
    "https://images.unsplash.com/photo-1600566753083-6f03a27a5b7d?auto=format&fit=crop&w=1200&q=80",
    "https://images.unsplash.com/photo-1600096194592-1d1959e26e8f?auto=format&fit=crop&w=1200&q=80"
  ],
  "Frisbee Golf": [
    "https://images.unsplash.com/photo-1580927752452-89b70c47d643?auto=format&fit=crop&w=1200&q=80",
    "https://images.unsplash.com/photo-1525182008055-f88b95ff7980?auto=format&fit=crop&w=1200&q=80",
    "https://images.unsplash.com/photo-1576615276145-d3b17d88d34e?auto=format&fit=crop&w=1200&q=80"
  ],
  "Crazy Golf": [
    "https://images.unsplash.com/photo-1626372969402-b10ac0f7e2b5?auto=format&fit=crop&w=1200&q=80",
    "https://images.unsplash.com/photo-1590096082801-c9a2de36f08e?auto=format&fit=crop&w=1200&q=80",
    "https://images.unsplash.com/photo-1619111623452-18a4b756d34d?auto=format&fit=crop&w=1200&q=80"
  ],
  "Murder Mystery": [
    "https://images.unsplash.com/photo-1497032628192-86f99bcd76bc?auto=format&fit=crop&w=1200&q=80",
    "https://images.unsplash.com/photo-1487180144351-b8472da7d491?auto=format&fit=crop&w=1200&q=80",
    "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=1200&q=80"
  ]
};

/* -----------------------------
   CAROUSEL LOGIC
------------------------------ */
const carouselImage = document.getElementById("carouselImage");
const prevArrow = document.getElementById("prevArrow");
const nextArrow = document.getElementById("nextArrow");
const carouselThumbs = document.getElementById("carouselThumbs");
const imageUrlInput = document.getElementById("imageUrl");
const categorySelect = document.getElementById("category");

let currentCategory = "Theatre";
let currentIndex = 0;
let hasSelected = false;

function loadCategoryImages(category) {
  currentCategory = category in stockImages ? category : "Theatre";
  currentIndex = 0;
  hasSelected = false;
  updateCarousel();
}

function updateCarousel() {
  const images = stockImages[currentCategory];
  carouselImage.src = images[currentIndex];
  if (!hasSelected) {
    carouselImage.classList.remove("selected");
  }
  renderThumbs();
}

function renderThumbs() {
  const images = stockImages[currentCategory];
  carouselThumbs.innerHTML = "";
  images.forEach((url, i) => {
    const img = document.createElement("img");
    img.src = url;
    if (hasSelected && i === currentIndex) img.classList.add("selected");
    img.addEventListener("click", () => {
      currentIndex = i;
      selectCurrent();
    });
    carouselThumbs.appendChild(img);
  });
}

function selectCurrent() {
  const images = stockImages[currentCategory];
  imageUrlInput.value = images[currentIndex];
  hasSelected = true;
  carouselImage.classList.add("selected");
  renderThumbs();
}

prevArrow.addEventListener("click", () => {
  const images = stockImages[currentCategory];
  currentIndex = (currentIndex - 1 + images.length) % images.length;
  hasSelected = false;
  updateCarousel();
});

nextArrow.addEventListener("click", () => {
  const images = stockImages[currentCategory];
  currentIndex = (currentIndex + 1) % images.length;
  hasSelected = false;
  updateCarousel();
});

carouselImage.addEventListener("click", selectCurrent);
categorySelect.addEventListener("change", (e) => loadCategoryImages(e.target.value));
imageUrlInput.addEventListener("change", () => {
  if (imageUrlInput.value.trim()) {
    carouselImage.src = imageUrlInput.value;
    hasSelected = true;
    carouselImage.classList.add("selected");
  }
});

loadCategoryImages(currentCategory);

/* -----------------------------
   SCHEDULE TABS
------------------------------ */
const singleTab = document.getElementById("singleTab");
const recurringTab = document.getElementById("recurringTab");
const tourTab = document.getElementById("tourTab");
const singleSection = document.getElementById("singleSection");
const recurringSection = document.getElementById("recurringSection");
const tourSection = document.getElementById("tourSection");

function resetTabs() {
  singleTab.classList.remove("bg-blue-600");
  recurringTab.classList.remove("bg-blue-600");
  tourTab.classList.remove("bg-blue-600");
  singleTab.classList.add("bg-gray-800");
  recurringTab.classList.add("bg-gray-800");
  tourTab.classList.add("bg-gray-800");
  singleSection.classList.add("hidden");
  recurringSection.classList.add("hidden");
  tourSection.classList.add("hidden");
}

singleTab.addEventListener("click", () => {
  resetTabs();
  singleTab.classList.add("bg-blue-600");
  singleSection.classList.remove("hidden");
});
recurringTab.addEventListener("click", () => {
  resetTabs();
  recurringTab.classList.add("bg-blue-600");
  recurringSection.classList.remove("hidden");
});
tourTab.addEventListener("click", () => {
  resetTabs();
  tourTab.classList.add("bg-blue-600");
  tourSection.classList.remove("hidden");
});

/* -----------------------------
   FORM SUBMISSION (demo)
------------------------------ */
document.getElementById("createEventForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const form = e.target;
  const data = {
    event_name: form.event_name.value,
    description: form.description.value,
    category: form.category.value,
    image_url: form.image_url.value,
    publish_status: form.publish_status.value,
    event_date: form.event_date.value,
    event_time: form.event_time.value,
    venue_name: form.venue_name.value,
    city_town: form.city_town.value,
    postcode: form.postcode.value
  };

  console.log("Submitting:", data);

  const { error } = await supabase.from("events").insert([data]);
  if (error) {
    alert("Error submitting event");
    console.error(error);
  } else {
    alert("Event saved!");
    form.reset();
    loadCategoryImages(currentCategory);
  }
});
</script>
</body>
</html>
