<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Event Organiser Dashboard – Spondle</title>

  <link rel="stylesheet" href="app.v15.css" />
  <link rel="stylesheet" href="app.v17.css" />

  <style>
    :root { --header-offset: 72px; }

    .wrap { max-width: 980px; margin: 0 auto; }
    .panel {
      background: #0f1420; border: 1px solid rgba(255,255,255,.08);
      border-radius: 16px; padding: 16px;
    }
    .twocol { display: grid; gap: 16px; }
    @media (min-width: 900px){ .twocol { grid-template-columns: 1.1fr .9fr; } }

    .field { margin-bottom: 12px; }
    .field label { display:block; font-size:14px; color:#9aa3b2; margin-bottom:6px; }
    .input, .select, textarea {
      width:100%; padding:10px 12px; border-radius:12px; color:#e9edf3;
      background:#0c1018; border:1px solid rgba(255,255,255,.08);
    }
    textarea { min-height: 96px; resize: vertical; }

    .row { display:flex; gap:10px; }
    .row > * { flex:1; }

    .subtle { color:#9aa3b2; font-size:13px; }
    .divider { height:1px; background:rgba(255,255,255,.08); margin:12px 0; }

    .btn.primary { background: linear-gradient(90deg,#5ef1ba,#77c2ff); color:#0c1018; border-color: transparent; }
    .btn.ghost { background: transparent; border: 1px solid rgba(255,255,255,.14); }
    .btn.small { padding: 8px 12px; border-radius: 10px; }

    /* preview tile (matches site style) */
    .card { scroll-margin-top: var(--header-offset); }
    .thumb {
      position: relative; border-radius: 12px; overflow: hidden;
      background: linear-gradient(135deg, #1a2230, #0d1220);
      border: 1px solid rgba(255,255,255,0.06); margin-bottom: 10px;
    }
    .thumb::before { content:""; display:block; padding-top:56.25%; }
    .thumb-img { position:absolute; inset:0; background-position:center; background-size:cover; }
    .thumb-gradient {
      position:absolute; inset:0;
      background:
        radial-gradient(60% 80% at 20% 20%, rgba(94,241,186,0.25) 0%, rgba(94,241,186,0) 60%),
        radial-gradient(70% 80% at 80% 20%, rgba(119,194,255,0.25) 0%, rgba(119,194,255,0) 60%),
        linear-gradient(180deg, rgba(0,0,0,0.00) 40%, rgba(0,0,0,0.25) 100%);
    }
    .thumb .badge {
      position:absolute; left:10px; bottom:10px; background:rgba(14,18,23,.7);
      border:1px solid rgba(255,255,255,.08); padding:6px 10px; border-radius:999px; font-size:12px;
      backdrop-filter: blur(4px);
    }
    .thumb .heart {
      position:absolute; right:10px; top:10px; width:34px; height:34px; border-radius:999px;
      background:rgba(14,18,23,.6); border:1px solid rgba(255,255,255,.08); display:grid; place-items:center;
    }

    .dates-list { display:flex; flex-wrap:wrap; gap:8px; margin-top:6px; }
    .chip {
      background:#142235; border:1px solid rgba(255,255,255,.08); color:#e9edf3;
      border-radius:999px; padding:6px 10px; font-size:12px; display:inline-flex; gap:6px; align-items:center;
    }
    .chip button { all:unset; cursor:pointer; opacity:.8 }
    .chip button:hover { opacity: 1; }

    .note { font-size: 12px; color: #9aa3b2; margin-top: 6px; }
    .success { color: #7de1c3; font-weight: 600; }
    .error { color: #ff8a8a; font-weight: 600; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header" id="siteHeader">
    <div class="nav-wrap">
      <a class="brand" href="index.html">
        <span class="brand-dot" aria-hidden="true"></span>
        <span class="brand-name">Spondle</span>
        <span class="beta-pill">Beta</span>
      </a>
      <nav class="main-nav" aria-label="Primary">
        <a class="nav-tab" href="index.html">Explore<br/>Events</a>
        <a class="nav-tab" href="favourites.html">Favourites</a>
        <a class="nav-tab" href="events.html">All<br/>Events</a>
        <a class="nav-tab is-active" href="organisers.html">Event Organiser<br/>Dashboard</a>
      </nav>
    </div>
  </header>
  <div class="header-spacer" id="headerSpacer"></div>

  <!-- Page -->
  <main class="page">
    <div class="wrap twocol">
      <!-- LEFT: Form -->
      <section class="panel" aria-labelledby="formTitle">
        <h1 id="formTitle" style="margin-top:0">Event Organiser Dashboard</h1>
        <p class="subtle" style="margin-top:4px">Draft an event. This MVP saves to your device only (no live publication yet).</p>
        <div class="divider"></div>

        <form id="eventForm" novalidate>
          <div class="field">
            <label for="title">Event title *</label>
            <input class="input" id="title" required placeholder="e.g., The Harbourside Sessions">
          </div>

          <div class="row">
            <div class="field">
              <label for="category">Category *</label>
              <select id="category" class="select" required>
                <option value="">Choose…</option>
                <option>Live Music</option><option>Comedy</option><option>Food & Drink</option>
                <option>Theatre</option><option>Community</option><option>Film</option>
                <option>Talks</option><option>Family</option>
              </select>
            </div>
            <div class="field">
              <label for="price">Price label</label>
              <input class="input" id="price" placeholder="e.g., Free Entry or £12">
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label for="venue">Venue *</label>
              <input class="input" id="venue" required placeholder="e.g., The Louisiana">
            </div>
            <div class="field">
              <label for="city">City *</label>
              <input class="input" id="city" required placeholder="e.g., Bristol">
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label for="postcode">Postcode *</label>
              <input class="input" id="postcode" required placeholder="e.g., BS1 4QA">
              <div class="note">Later we’ll auto-geocode this for maps & distance search.</div>
            </div>
            <div class="field">
              <label for="address">Address (optional)</label>
              <input class="input" id="address" placeholder="Street & number">
            </div>
          </div>

          <div class="field">
            <label for="desc">Description (short)</label>
            <textarea id="desc" placeholder="A couple of lines to sell the event…"></textarea>
          </div>

          <div class="divider"></div>

          <!-- Dates -->
          <div class="field">
            <label>Dates & times *</label>
            <div class="row">
              <input class="input" id="date" type="date" required>
              <input class="input" id="start" type="time" required>
              <input class="input" id="end" type="time" required>
            </div>
            <div class="row" style="margin-top:8px">
              <button type="button" class="btn small ghost" id="addDateBtn">Add date</button>
              <button type="button" class="btn small ghost" id="addWeeklyBtn">+ 4 weekly dates</button>
              <button type="button" class="btn small ghost" id="clearDatesBtn">Clear dates</button>
            </div>
            <div id="datesList" class="dates-list" aria-live="polite"></div>
            <div class="note">Add one or more dates. You can clone weekly to speed things up.</div>
          </div>

          <div class="divider"></div>

          <!-- Visibility -->
          <div class="field">
            <label>Visibility *</label>
            <div class="row">
              <label><input type="radio" name="vis" value="public" checked> Public (listed to everyone)</label>
              <label><input type="radio" name="vis" value="restricted"> Restricted by postcode radius</label>
            </div>
            <div id="restrictRow" class="row" style="display:none; margin-top:8px">
              <input class="input" id="restrictPostcode" placeholder="Anchor postcode (e.g., BS1 4QA)">
              <input class="input" id="restrictRadius" type="number" min="1" max="50" placeholder="Radius (miles)">
            </div>
            <div class="note">When restricted, only signed-in users within the radius will see it.</div>
          </div>

          <div class="divider"></div>

          <div class="row">
            <button type="submit" class="btn primary">Save draft</button>
            <button type="button" id="exportBtn" class="btn ghost">Export JSON</button>
            <a class="btn ghost" href="events.html">Preview on All Events</a>
          </div>
          <div id="msg" class="note" role="status" style="margin-top:8px"></div>
        </form>
      </section>

      <!-- RIGHT: Live preview -->
      <aside class="panel" aria-labelledby="prevTitle">
        <h2 id="prevTitle" style="margin-top:0">Live preview</h2>
        <div id="previewMount">
          <a class="card" href="event.html?id=draft-preview">
            <div class="thumb">
              <div id="pImg" class="thumb-gradient"></div>
              <span class="badge" id="pBadge">City • Date</span>
              <button class="heart" type="button" aria-label="Save" disabled>♡</button>
            </div>
            <h3 class="card-title" id="pTitle">Event title</h3>
            <p class="meta" id="pMeta">Venue • 19:30–22:30</p>
            <span class="price-chip" id="pPrice">Price</span>
          </a>
        </div>
        <p class="subtle" style="margin-top:10px">This is how your event will appear in results.</p>
      </aside>
    </div>
  </main>

  <footer class="site-footer">
    <small>© 2025 Spondle • build v32f</small>
  </footer>

  <script>
    // Header spacer
    const setSpacer=()=>{
      const h=document.getElementById('siteHeader').offsetHeight;
      document.getElementById('headerSpacer').style.height=h+'px';
      document.documentElement.style.setProperty('--header-offset',(h+8)+'px');
    };
    window.addEventListener('load',setSpacer,{once:true});
    window.addEventListener('resize',setSpacer);

    // Visibility controls
    const visRadios = document.querySelectorAll('input[name="vis"]');
    const restrictRow = document.getElementById('restrictRow');
    visRadios.forEach(r=>r.addEventListener('change',()=>{
      restrictRow.style.display = (document.querySelector('input[name="vis"]:checked').value === 'restricted') ? '' : 'none';
    }));

    // Dates collection
    const dates = [];
    const datesList = document.getElementById('datesList');
    function renderDates(){
      datesList.innerHTML = dates.map((d,i)=>(
        `<span class="chip">${d.date} ${d.start}-${d.end} <button type="button" data-i="${i}" aria-label="Remove">✕</button></span>`
      )).join('');
    }
    datesList.addEventListener('click', e=>{
      const b=e.target.closest('button[data-i]'); if(!b) return;
      dates.splice(+b.dataset.i,1); renderDates(); updatePreview();
    });

    function addDate(d){
      dates.push(d); renderDates(); updatePreview();
    }

    function addWeeklyClones(){
      const baseDate = document.getElementById('date').value;
      const start = document.getElementById('start').value || '19:30';
      const end   = document.getElementById('end').value   || '22:30';
      if(!baseDate) return;
      const base = new Date(baseDate+'T12:00:00');
      for(let w=1; w<=4; w++){
        const d = new Date(base); d.setDate(d.getDate()+7*w);
        const iso = d.toISOString().slice(0,10);
        addDate({date: iso, start, end});
      }
    }

    document.getElementById('addDateBtn').addEventListener('click', ()=>{
      const d=document.getElementById('date').value;
      const s=document.getElementById('start').value;
      const e=document.getElementById('end').value;
      if(!d||!s||!e) return;
      addDate({date:d,start:s,end:e});
    });
    document.getElementById('addWeeklyBtn').addEventListener('click', addWeeklyClones);
    document.getElementById('clearDatesBtn').addEventListener('click', ()=>{ dates.length=0; renderDates(); updatePreview(); });

    // Live preview wiring
    function fmtBadge(d){ if(!d.length) return 'City • Date'; const one=d[0]; return `${(document.getElementById('city').value||'City')} • ${one.date}`; }
    function fmtMeta(){ const v=document.getElementById('venue').value||'Venue', s=(dates[0]?.start||'19:30'), e=(dates[0]?.end||'22:30'); return `${v} • ${s}–${e}`; }

    function updatePreview(){
      document.getElementById('pTitle').textContent = document.getElementById('title').value || 'Event title';
      document.getElementById('pMeta').textContent  = fmtMeta();
      document.getElementById('pBadge').textContent = fmtBadge(dates);
      document.getElementById('pPrice').textContent = (document.getElementById('price').value || 'Price');
    }

    ['title','venue','city','price','date','start','end'].forEach(id=>{
      const el=document.getElementById(id); el.addEventListener('input', updatePreview);
      el.addEventListener('change', updatePreview);
    });

    // Save draft (local only)
    function validate(){
      const req = ['title','category','venue','city','postcode'];
      for(const id of req){ const el=document.getElementById(id); if(!el.value){ el.focus(); return `${id} is required`; } }
      if(dates.length===0) return 'Add at least one date';
      return '';
    }

    function buildDraft(){
      const vis = document.querySelector('input[name="vis"]:checked')?.value || 'public';
      const draft = {
        id: 'draft-' + Date.now(),
        title: document.getElementById('title').value.trim(),
        category: document.getElementById('category').value,
        priceLabel: document.getElementById('price').value.trim(),
        venue: document.getElementById('venue').value.trim(),
        city: document.getElementById('city').value.trim(),
        postcode: document.getElementById('postcode').value.trim(),
        address: document.getElementById('address').value.trim(),
        description: document.getElementById('desc').value.trim(),
        dates: dates.slice(),
        visibility: vis,
        restrict: (vis==='restricted') ? {
          postcode: document.getElementById('restrictPostcode').value.trim(),
          radiusMiles: Number(document.getElementById('restrictRadius').value||0)
        } : null,
        image: "" // placeholder (future: upload -> URL)
      };
      return draft;
    }

    const MSG = document.getElementById('msg');
    document.getElementById('eventForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const err = validate();
      if(err){ MSG.innerHTML = `<span class="error">✕ ${err}</span>`; return; }
      const draft = buildDraft();
      const key = 'spondle:drafts';
      const list = JSON.parse(localStorage.getItem(key)||'[]');
      list.unshift(draft);
      localStorage.setItem(key, JSON.stringify(list));
      MSG.innerHTML = `<span class="success">✓ Draft saved locally. (Not published)</span>`;
      // Optionally clear? For now, keep values so organiser can tweak.
    });

    // Export JSON (for review / future API)
    document.getElementById('exportBtn').addEventListener('click', ()=>{
      const err = validate();
      if(err){ MSG.innerHTML = `<span class="error">✕ ${err}</span>`; return; }
      const draft = buildDraft();
      const blob = new Blob([JSON.stringify(draft, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = (draft.title||'event-draft') + '.json';
      document.body.appendChild(a); a.click();
      URL.revokeObjectURL(url); a.remove();
      MSG.innerHTML = `<span class="success">✓ JSON exported.</span>`;
    });

    // Init preview with defaults
    updatePreview();
  </script>
</body>
</html>
